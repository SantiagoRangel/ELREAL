

SELECT SEGMENTO
FROM (SELECT COUNT(DISTINCT IDCONTRATO) AS CUENTA, SEGMENTO
FROM (SELECT TRUNC (((SYSDATE-DIA)/7),0) AS SEGMENTO
FROM (SELECT TRUNC (SYSDATE - ROWNUM) AS DIA
FROM DUAL CONNECT BY ROWNUM <= (SELECT *
FROM (SELECT TRUNC((SYSDATE - TO_DATE(FECHAINIC, 'YYYY-MM-DD"T"HH24:MI:SS"Z"')),0) AS ANTIGUEDAD
FROM CONTRATO
ORDER BY ANTIGUEDAD DESC)
WHERE ROWNUM = 1))) INNER JOIN
(SELECT IDCONTRATO, COSTO, FECHAINIC, FECHAFINAL,
TRUNC((ANTIGUEDAD/7),0) AS SEGI, TRUNC (((ANTIGUEDAD+DURACION)/7),0) AS SEGII
FROM (SELECT IDCONTRATO, COSTO, FECHAINIC, FECHAFINAL,
(TO_DATE(FECHAFINAL, 'YYYY-MM-DD"T"HH24:MI:SS"Z"')-TO_DATE(FECHAINIC, 'YYYY-MM-DD"T"HH24:MI:SS"Z"')) AS DURACION, 
GREATEST ((SYSDATE-TO_DATE(FECHAFINAL, 'YYYY-MM-DD"T"HH24:MI:SS"Z"')), 0) AS ANTIGUEDAD
FROM CONTRATO)) ON 
SEGMENTO >= SEGI AND SEGMENTO <= SEGII
GROUP BY SEGMENTO
ORDER BY CUENTA DESC) 
WHERE ROWNUM = 1;

Respuesta al segmento mas ocupado

SELECT SEGMENTO
FROM (SELECT COUNT(DISTINCT IDCONTRATO) AS CUENTA, SEGMENTO
FROM (SELECT TRUNC (((SYSDATE-DIA)/7),0) AS SEGMENTO
FROM (SELECT TRUNC (SYSDATE - ROWNUM) AS DIA
FROM DUAL CONNECT BY ROWNUM <= (SELECT *
FROM (SELECT TRUNC((SYSDATE - TO_DATE(FECHAINIC, 'YYYY-MM-DD"T"HH24:MI:SS"Z"')),0) AS ANTIGUEDAD
FROM CONTRATO
ORDER BY ANTIGUEDAD DESC)
WHERE ROWNUM = 1))) INNER JOIN
(SELECT IDCONTRATO, COSTO, FECHAINIC, FECHAFINAL,
TRUNC((ANTIGUEDAD/7),0) AS SEGI, TRUNC (((ANTIGUEDAD+DURACION)/7),0) AS SEGII
FROM (SELECT IDCONTRATO, COSTO, FECHAINIC, FECHAFINAL,
(TO_DATE(FECHAFINAL, 'YYYY-MM-DD"T"HH24:MI:SS"Z"')-TO_DATE(FECHAINIC, 'YYYY-MM-DD"T"HH24:MI:SS"Z"')) AS DURACION, 
GREATEST ((SYSDATE-TO_DATE(FECHAFINAL, 'YYYY-MM-DD"T"HH24:MI:SS"Z"')), 0) AS ANTIGUEDAD
FROM CONTRATO)) ON 
SEGMENTO >= SEGI AND SEGMENTO <= SEGII
GROUP BY SEGMENTO
ORDER BY CUENTA ASC) 
WHERE ROWNUM = 1;

Respuesta al segmento menos ocupado

SELECT SEGMENTO 
FROM (SELECT SUM(MONTO) AS LUKA, SEGMENTO
FROM (SELECT (COSTOTOTAL/OCUPACION) AS MONTO, SEGMENTO
FROM (SELECT SUM(COSTO) AS COSTOTOTAL, COUNT (IDCONTRATO) AS OCUPACION, SEGMENTO, IDCONTRATO 
FROM (SELECT TRUNC (((SYSDATE-DIA)/7),0) AS SEGMENTO
FROM (SELECT TRUNC (SYSDATE - ROWNUM) AS DIA
FROM DUAL CONNECT BY ROWNUM <= (SELECT *
FROM (SELECT TRUNC((SYSDATE - TO_DATE(FECHAINIC, 'YYYY-MM-DD"T"HH24:MI:SS"Z"')),0) AS ANTIGUEDAD
FROM CONTRATO
ORDER BY ANTIGUEDAD DESC)
WHERE ROWNUM = 1))) INNER JOIN
(SELECT IDCONTRATO, COSTO, FECHAINIC, FECHAFINAL,
TRUNC((ANTIGUEDAD/7),0) AS SEGI, TRUNC (((ANTIGUEDAD+DURACION)/7),0) AS SEGII
FROM (SELECT IDCONTRATO, COSTO, FECHAINIC, FECHAFINAL,
(TO_DATE(FECHAFINAL, 'YYYY-MM-DD"T"HH24:MI:SS"Z"')-TO_DATE(FECHAINIC, 'YYYY-MM-DD"T"HH24:MI:SS"Z"')) AS DURACION, 
GREATEST ((SYSDATE-TO_DATE(FECHAFINAL, 'YYYY-MM-DD"T"HH24:MI:SS"Z"')), 0) AS ANTIGUEDAD
FROM CONTRATO)) ON 
SEGMENTO >= SEGI AND SEGMENTO <= SEGII
GROUP BY SEGMENTO, IDCONTRATO))
GROUP BY SEGMENTO
ORDER BY SEGMENTO DESC)
WHERE ROWNUM = 1;

Respuesta al de Mayores Ingresos
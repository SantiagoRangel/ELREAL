SELECT * 
FROM OFERTA 
WHERE OFERTA.IDOFERTA IN (SELECT IDOFERTA
FROM (SELECT (TIEMPOO-LASUMA) AS DESO, IDOFERTA
FROM (SELECT SUM(TIEMPOC) AS LASUMA, TIEMPOO, IDOFERTA
FROM (SELECT (FIOM-FFOM) AS TIEMPOO, (FICM-FFCM) AS TIEMPOC, IDOFERTA
FROM (SELECT TRUNC(SYSDATE - TO_DATE(FIO, 'YYYY-MM-DD'),0) AS FIOM, TRUNC(SYSDATE - TO_DATE(FFO, 'YYYY-MM-DD'),0) AS FFOM,
TRUNC(SYSDATE - TO_DATE(FFC, 'YYYY-MM-DD'),0) AS FFCM, TRUNC(SYSDATE - TO_DATE(FIC, 'YYYY-MM-DD'),0) AS FICM, IDOFERTA
FROM (SELECT FIO, FFO, IDOFERTA, FFC, FIC
FROM (SELECT IDHABITACION AS IDHO, IDAPARTAMENTO AS IDAO, IDVIVIENDA AS IDVO, FECHAINICIAL AS FIO, FECHAFINAL AS FFO, IDOFERTA
FROM OFERTA) INNER JOIN (SELECT FECHAFINAL AS FFC, FECHAINIC AS FIC, IDHABITACION AS IDHC, IDAPARTAMENTO AS IDAC, IDVIVIENDA AS IDVC 
FROM CONTRATO) ON NVL(IDHO,0) = NVL(IDHC,0) AND 
NVL(IDAO,0) = NVL(IDAC,0) AND NVL(IDVO,0) = NVL(IDVC,0)
AND TO_DATE(FIC, 'YYYY-MM-DD') - TO_DATE(FIO, 'YYYY-MM-DD') >= 0 AND TO_DATE(FFC, 'YYYY-MM-DD') - TO_DATE(FFO, 'YYYY-MM-DD') <= 0)))
GROUP BY IDOFERTA, TIEMPOO))
WHERE DESO > 30);
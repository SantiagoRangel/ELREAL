SELECT NOCHES, TOTAL, HABITA, APTO, VIVIEN
FROM((SELECT SUM (TIEMPO) AS NOCHES, SUM (MONTO) AS TOTAL, CLI AS USUARIOI, COUNT(HAB) AS HABITA, COUNT(APT) APTO, COUNT(VIV) VIVIEN
FROM (SELECT MONTO, TIEMPO, CONTRA, CLI, HAB, VIV, APT
FROM ((SELECT IDCLIENTE AS CRI FROM CLIENTE) INNER JOIN
(SELECT COSTO AS MONTO, ((TO_DATE(FECHAFINAL,  'YYYY-MM-DD HH24:MI:SS'))-(TO_DATE(FECHAINIC,  'YYYY-MM-DD HH24:MI:SS'))) AS TIEMPO,
NOCHES AS NAKT, IDCONTRATO AS CONTRA, IDCLIENTE AS CLI, IDHABITACION AS HAB, IDVIVIENDA AS VIV, IDAPARTAMENTO AS APT
FROM CONTRATO) ON CRI = CLI)) 
GROUP BY CLI) UNION ALL
(SELECT SUM (TIEMPO) AS NOCHES, SUM (MONTO), OPE AS USUARIOII, COUNT(HAB), COUNT(APT), COUNT(VIV)
FROM (SELECT MONTO, TIEMPO, CONTRA, OPE, HAB, VIV, APT
FROM ((SELECT IDOPERADOR AS OP FROM OPERADOR) INNER JOIN
(SELECT COSTO AS MONTO, ((TO_DATE(FECHAFINAL,  'YYYY-MM-DD HH24:MI:SS'))-(TO_DATE(FECHAINIC,  'YYYY-MM-DD HH24:MI:SS'))) AS TIEMPO,
NOCHES AS NAKT, IDCONTRATO AS CONTRA, IDOPERADOR AS OPE, IDHABITACION AS HAB, IDVIVIENDA AS VIV, IDAPARTAMENTO AS APT
FROM CONTRATO) ON OPE = OP)) 
GROUP BY OPE))
WHERE USUARIOI = %2$d
